#pragma once

#include "TerrainMap.h"

#include <octomap/octomap.h>
#include <octomap_msgs/conversions.h>
#include <octomap_msgs/Octomap.h>
#include <octomap_msgs/GetOctomap.h>

#include <nav_msgs/OccupancyGrid.h>

#include <ros/ros.h>

#include <unistd.h>
#include <stdlib.h>
#include <vector>


class OctoTerrainMap : TerrainMap{
public:
    OctoTerrainMap(ros::NodeHandle nh);
    ~OctoTerrainMap();
    
    BekkerData getSoilDataAt(float x, float y) const override;
    float getAltitude(float x, float y, float z_guess) const override;
    int isStateValid(float x, float y) const override;
    std::vector<Rectangle*> getObstacles() const override;

    void ocGridCallback(const nav_msgs::OccupancyGrid::ConstPtr& msg);

    float getMapRes();
private:
    octomap::OcTree* octomap_;
    
    unsigned rows_;
    unsigned cols_;
    float map_res_;
    unsigned char *oc_grid_;
    
    
    float Xmin, Xmax, Ymin, Ymax;
};

